// Module included in the following assemblies:
//
// * rosa_getting_started_sts/rosa-sts-creating-cluster.adoc

[id="rosa-sts-about-iam-resources_{context}"]
= About IAM resources for clusters that use STS

To deploy a {product-title} (ROSA) cluster that uses the AWS Security Token Service (STS), you must create the following AWS Identity Access Management (IAM) resources:

* Specific account-wide IAM roles and policies that provide the STS permissions required for ROSA support, installation, control plane and compute functionality. This includes account-wide Operator policies.
* Cluster-specific Operator IAM roles that permit the ROSA cluster Operators to carry out core OpenShift functionality.
* An OpenID Connect (OIDC) provider that the cluster Operators use to authenticate.

This section provides an overview about each of the IAM resources that you must deploy when you create a ROSA cluster that uses STS. For detailed steps to create the resources, see the _Creating your cluster using STS_ section.

[id="rosa-sts-account-wide-roles-and-policies_{context}"]
== Account-wide IAM roles and policies

The following account-wide IAM roles and policies are required for ROSA deployments that use STS. 

The account-wide roles and policies are specific to an OpenShift version, for example OpenShift 4.8. You can minimize the required STS resources by reusing the account-wide roles and policies for multiple clusters of the same version.

[NOTE]
====
If your use case requires it, you can deploy multiple sets of account-wide IAM roles and policies for a cluster version by specifying different prefixes for each set.
====

[cols="1,2",options="header"]
|===

|Resource|Description

|`ManagedOpenShift-Installer-Role`
|An IAM role used by the ROSA installer.

|`ManagedOpenShift-Installer-Role-Policy`
|An inline IAM policy that provides the ROSA installer with the permissions required to complete cluster installation tasks.

|`ManagedOpenShift-Support-Role`
|An IAM role used by the Red Hat Site Reliability Engineering (SRE) support team.

|`ManagedOpenShift-Support-Role-Policy`
|An inline IAM policy that provides the Red Hat SRE support team with the permissions required to support ROSA clusters. 

|`ManagedOpenShift-ControlPlane-Role`
|An IAM role used by the ROSA control plane.

|`ManagedOpenShift-ControlPlane-Role-Policy`
|An inline IAM policy that provides the ROSA control plane with the permissions required to manage its components. 

|`ManagedOpenShift-Worker-Role`
|An IAM role used by the ROSA compute instances.

|`ManagedOpenShift-Worker-Role-Policy`
|An inline IAM policy that provides the ROSA compute instances with the permissions required to manage their components.  

|`ManagedOpenShift-openshift-machine-api-aws-cloud-credentials`
|A managed IAM policy that provides the ROSA Machine Config Operator with the permissions required to perform core cluster functionality. 

|`ManagedOpenShift-openshift-cloud-credential-operator-cloud-credentials`
|A managed IAM policy that provides the ROSA Cloud Credential Operator with the permissions required to manage cloud provider credentials.

|`ManagedOpenShift-openshift-image-registry-installer-cloud-credentials`
|A managed IAM policy that provides the ROSA Image Registry Operator with the permissions required to manage the internal registry storage in AWS S3 for a cluster.

|`ManagedOpenShift-openshift-ingress-operator-cloud-credentials`
|A managed IAM policy that provides the ROSA Ingress Operator with the permissions required to manage external access to a cluster. 

|`ManagedOpenShift-openshift-cluster-csi-drivers-ebs-cloud-credentials`
|A managed IAM policy required by ROSA to manage back-end storage through the Container Storage Interface (CSI).

|===

[NOTE]
====
The IAM role and policy names include the role prefix that is specified when the STS resources are created. The resource names in the examples provided include the default prefix `ManagedOpenShift`.
====

[id="rosa-sts-operator-roles_{context}"]
== Cluster-specific Operator IAM roles

The following cluster-specific IAM roles are required by the cluster Operators in ROSA deployments that use STS.

When you create the Operator roles by using the `rosa` CLI, the account-wide Operator policies for the matching cluster version are attached to the roles. The Operator policies are tagged with the Operator and version they are compatible with. The correct policy for an Operator role is determined by using the tags. 

[NOTE]
====
If more than one matching policy is available in your account for an Operator role, an interactive list of options is provided when you create the Operator.
====

[cols="1,2",options="header"]
|===

|Resource|Description

|`ManagedOpenShift-openshift-machine-api-aws-cloud-credentials`
|An IAM role required by the ROSA Machine Config Operator to perform core cluster functionality.

|`ManagedOpenShift-openshift-cloud-credential-operator-cloud-credentials`
|An IAM role required by the ROSA Cloud Credential Operator to cloud provider credentials.

|`ManagedOpenShift-openshift-image-registry-installer-cloud-credentials`
|An IAM role required by the ROSA Image Registry Operator to manage the internal registry storage in AWS S3 for a cluster.

|`ManagedOpenShift-openshift-ingress-operator-cloud-credentials`
|An IAM role required by the ROSA Ingress Operator to manage external access to a cluster.

|`ManagedOpenShift-openshift-cluster-csi-drivers-ebs-cloud-credentials`
|An IAM role required by ROSA to manage back-end storage through the Container Storage Interface (CSI).

|===

[id="rosa-sts-oidc-provider-for-operators_{context}"]
== An OIDC provider for Operator authentication

For ROSA installations that use STS, you must create a cluster-specific OIDC provider that is used by the cluster Operators to authenticate.
