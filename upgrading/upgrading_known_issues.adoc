[[install-config-upgrading-known-issues]]
= Known Issues
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

== Overview

When upgrading your {product-title} cluster, there are two primary data
migrations that take place. The first occurs while still running the current
version of {product-title}, and the second happens after the upgrade completes.

If the pre-upgrade migration fails, the upgrade will be halted and the cluster
administrator must resolve any data consistency problems before attempting the
upgrade again. If the post-upgrade migration fails, the upgrade will complete
and the cluster administrator should investigate the data migration issues as
soon as possible. This document catalogs known data consistency problems and how
to resolve them.

[[upgrading-known-issue-BZ1570777]]
== Missing NetworkPolicy Storage Migration Rules in 3.7.9-3.7.22

`NetworkPolicy` objects have migration errors in {product-title} versions 3.7.9 to 3.7.22, due to missing migration rules.
(link:https://bugzilla.redhat.com/show_bug.cgi?id=1570777[*BZ#1570777*])

.Error Output
----
# oc adm --config=/etc/origin/master/admin.kubeconfig migrate storage --include=*  --confirm
E0423 16:04:43.881409 error:     -n policy networkpolicies/allow-all: NetworkPolicy.networking.k8s.io "allow-all" is invalid: spec: Forbidden: updates to networkpolicy spec are forbidden.
summary: total=1061 errors=1 ignored=0 unchanged=1010 migrated=49
info: to rerun only failing resources, add --include=networkpolicies
error: 1 resources failed to migrate
----

The solution is to upgrade the binaries to 3.7.23 or beyond and then migrate the
storage. If upgrading to 3.9 or beyond, upgrade to 3.7.23 first, migrate the
storage and then do a normal upgrade.