= Volumes
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview

OpenShift user can add, update, remove or list volumes in pods or pod templates.

== CLI Interface

OpenShift provides `oc volume` cmd to add, update or remove volumes and volume mounts
for any object that has a pod template like replication controllers or deployment configurations.
It can also list volumes in pods or any object that has a pod template.

General syntax:
----
$ oc volume <resource-selection> <operation> <mandatory-parameters> <optional-parameters>
----

User can pick one of the options to select the resource:[[resource-selection]]
[cols="3*",options="header"]
|===

|Syntax |Description |Example

|`_<resource_type>_ _<resource_name>_`
|Selects _<resource_name>_ of type _<resource_type>_
|deploymentConfig registry

|`_<resource_type>_/_<resource_name>_`
|Selects _<resource_name>_ of type _<resource_type>_
|deploymentConfig/registry

|`_<resource_type>_ --selector=_<resource_label_selector>_`
|Selects resources of type _<resource_type>_ that matched the given label selector
|deploymentConfig --selector="name=registry"

|`_<resource_type>_ --all`
|Selects all resources of type _<resource_type>_
|deploymentConfig --all

|`-f, --filename=_<resource_definition_file>_`
|Filename, directory, or URL to file to use to edit the resource.
|-f registry-deployment-config.json
|===

Operation can be one of --add or --remove or --list.

Mandatory and optional parameters are specific to the selected operation and will be
discussed in the later sections.

== Adding Volumes [[adding-volumes]]

To add a volume and/or volume mount to the pod templates:

----
$ oc volume <<resource-selection>> --add [options]
----

Add volume supported options: [[add-options]]
[cols="3*",options="header"]
|===

|Option |Description |Default

|`--name`
|Name of the volume
|Auto generated if not specified

|`-t, --type`
|Name of the volume source. Supported values: emptyDir, hostPath, secret, persistentVolumeClaim
|emptyDir

|`-c, --containers`
|Select containers by name. It can also take wildcard '*' that matches any character
|'*'

|`-m, --mount-path`
|Mount path inside the selected containers
|

|`--path`
|Host path. Mandatory param for --type=hostPath
|

|`--secret-name`
|Name of the secret. Mandatory param for --type=secret
|

|`--claim-name`
|Name of the persistent volume claim. Mandatory parm for --type=persistentVolumeClaim
|

|`--source`
|Details of volume source as JSON string. Recommended if the desired volume source is
not supported by `--type`. link:https://github.com/openshift/origin/blob/master/Godeps/_workspace/src/github.com/GoogleCloudPlatform/kubernetes/pkg/api/types.go#L179[Available volume sources]
|

|`-o, --output`
|Display the changed objects instead of updating them on the server. Supported values:
json, yaml
|

|`--output-version`
|Output the changed objects with the given version
|default api-version
|===

Some examples:

Add a new volume source 'emptyDir' for deployment config 'registry':
----
$ oc volume dc/registry --add
----

Add a volume 'v1' with secret '$ecret' for replication controller 'r1' and mount inside the containers at /data:
[options="nowrap"]
----
$ oc volume rc/r1 --add --name=v1 --type=secret --secret-name=$ecret --mount-path=/data
----

Add existing persistant volume 'v1' with claim name 'pvc1' to deployment config 'dc.json' on disk,
mount the volume on container 'c1' at /data and update the deployment config on the server:
----
$ oc volume -f dc.json --add --name=v1 --type=persistentVolumeClaim \
  --claim-name=pvc1 --mount-path=/data --containers=c1
----

Add volume 'v1' based on git reposity 'https://github.com/namespace1/project1' with revision '5125c45f9f563'
for all replication controllers:
----
$ oc volume rc --all --add --name=v1 \
  --source='{"gitRepo": {
                "repository": "https://github.com/namespace1/project1",
                "revision": "5125c45f9f563"
            }}'
----

== Updating Volumes

Updating existing volume or volume mount is same as <<adding-volumes>> with '--overwrite' option.

----
$ oc volume <<resource-selection>> --add --overwrite [<<add-options>>]
----

Some examples:

Replace existing volume 'v1' for replication controller 'r1' with existing persistent volume claim 'pvc1':
----
$ oc volume rc/r1 --add --overwrite --name=v1 --type=persistentVolumeClaim --claim-name=pvc1
----

Change deployment config 'd1' mount point to /opt for volume 'v1':
----
$ oc volume dc/d1 --add --overwrite --name=v1 --mount-path=/opt
----

== Removing Volumes

To remove a volume or volume mount from the pod templates:

----
$ oc volume <<resource-selection>> --remove [options]
----

Remove volume supported options:
[cols="3*",options="header"]
|===

|Option |Description |Default

|`--name`
|Name of the volume.
|

|`-c, --containers`
|Select containers by name. It can also take wildcard '*' that matches any character
|'*'

|`--confirm`
|Indicate that you want to remove multiple volumes at once
|

|`-o, --output`
|Display the changed objects instead of updating them on the server. Supported values:
json, yaml
|

|`--output-version`
|Output the changed objects with the given version
|default api-version
|===

Some examples:

Remove a volume 'v1' from deployment config 'd1':
----
$ oc volume dc/d1 --remove --name=v1
----

Unmount volume 'v1' from container 'c1' for deployment config 'd1' and 
remove the volume 'v1' if it is not referenced by any containers on 'd1':
----
$ oc volume dc/d1 --remove --name=v1 --containers=c1
----

Remove all volumes for replication controller 'r1':
----
$ oc volume rc/r1 --remove --confirm
----

== Listing Volumes

To list volumes or volume mounts for pods or pod templates:

----
$ oc volume <<resource-selection>> --list [options]
----

List volume supported options:
[cols="3*",options="header"]
|===

|Option |Description |Default

|`--name`
|Name of the volume.
|

|`-c, --containers`
|Select containers by name. It can also take wildcard '*' that matches any character
|'*'
|===

Some examples:

List all volumes for pod 'p1':
----
$ oc volume pod/p1 --list
----

List volume 'v1' defined on all deployment controllers:
----
$ oc volume dc --all --name=v1
----
