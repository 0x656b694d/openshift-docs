= Pod Autoscaling
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:

toc::[]

== Overview

A *HorizontalPodAutoscaler* object specifies how the system should automatically
increase or decrease the scale of a *ReplicationController* or *DeploymentConfig*,
based on metrics collected from the pods that belong to that *ReplicationController*
or *DeploymentConfig*.

[NOTE]
====
Horizontal Pod Autoscaling is currently a Tech Preview feature.
====

ifdef::openshift-origin,openshift-enterprise[]
== Requirements for Using Horizontal Pod Autoscalers

In order to use *HorizontalPodAutoscalers*, your cluster admin must have
link:../install_config/cluster_metrics.html[properly configured cluster metrics].
endif::openshift-origin,openshift-enterprise[]

== Metrics Supported

The following describes the metrics supported by *HorizontalPodAutoscalers*:

.Metrics
[cols="3a,8a",options="header"]
|===

|Metric |Description

|CPU Utilization
|Percentage of the link:../dev_guide/compute_resources.html#cpu-requests[requested CPU]
|===

== Scaling

Once a *HorizontalPodAutoscaler* is created, it will begin attempting to query
Heapster for metrics on the pods.  It may take 1-2 minutes before Heapster obtains
the initial metrics.  Once metrics are available in heapster, the *HorizontalPodAutoscaler*
will compute the ratio of the current metric utilization with the desired metric utilization,
and scale up or down accordingly.  The scaling will occur at a regular interval, but it may take
1-2 minutes before metrics make their way into Heapster.

For *ReplicationControllers*, this scaling corresponds directly to the replicas of the
*ReplicationController*.  For *DeploymentConfigs*, this will scale the latest deployment,
or, if no deployment is present, the *ReplicationController* template in the *DeploymentConfig*
(note that scaling will occur if the latest deployment is marked as `Complete`).

== Sample Horizontal Pod Autoscaler File

.scaler.yaml
====
[source,yaml,options="nowrap"]
----
apiVersion: extensions/v1beta1
kind: HorizontalPodAutoscaler
metadata:
  name: frontend-scaler <1>
spec:
  scaleRef:
    kind: DeploymentConfig <2>
    name: frontend <3>
    apiVersion: v1 <4>
    subresource: scale
  minReplicas: 1 <5>
  maxReplicas: 10 <6>
  cpuUtilization:
    targetPercentage: 80 <7>
----
<1> The name of this horizontal pod autoscaler object
<2> The kind of object to scale
<3> The name of the object to scale
<4> The API version of the object to scale
<5> The minimum number of replicas to which to scale down
<6> The maximum number of replicas to which to scale up
<7> The percentage of the requested CPU that each pod should ideally be using
====

== Create a Horizontal Pod Autoscaler

To create a horizontal pod autoscaler:

----
$ oc create -f scaler.yaml
----

== View a Horizontal Pod Autocaler

To view the status of a horizontal pod autoscaler:

----
$ oc get hpa
NAME              REFERENCE                                 TARGET    CURRENT   MINPODS        MAXPODS   AGE
frontend-scaler   DeploymentConfig/default/frontend/scale   80%       79%       1              10        8d
$ oc describe hpa frontend-scaler
Name:                           frontend-scaler
Namespace:                      default
Labels:                         <none>
CreationTimestamp:              Mon, 26 Oct 2015 21:13:47 -0400
Reference:                      DeploymentConfig/default/frontend/scale
Target CPU utilization:         80%
Current CPU utilization:        79%
Min pods:                       1
Max pods:                       10
----

====

