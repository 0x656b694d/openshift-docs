= Managing Security Context Constraints
{product-author}
{product-version}
:data-uri:
:icons:
:experimental:
:toc: macro
:toc-title:
:prewrap!:

toc::[]

== Overview
You can manage
link:../architecture/additional_concepts/authorization.html#security-context-constraints[security context constraints]
in your instance via the `oc` command as a normal API objects.

[[listing-security-context-constraints]]

== Listing Security Context Constraints

[options="nowrap"]
----
$ oc get scc
NAME         PRIV      CAPS      HOSTDIR   SELINUX     RUNASUSER
privileged   true      []        true      RunAsAny    RunAsAny
restricted   false     []        false     MustRunAs   MustRunAsRange
----

[[creating-new-security-context-constraints]]

== Creating New Security Context Constraints

Creating a new SCC is accomplished with the `oc create` command.  First, define the SCC in a json
or yaml file and then run `oc create` passing the file.

[options="nowrap"]
----
kind: SecurityContextConstraints
apiVersion: v1
metadata:
  name: scc-admin
allowPrivilegedContainer: true
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: RunAsAny
users:
- my-admin-user
groups:
- my-admin-group

$ oc create -f scc_admin.yaml
securitycontextconstraints/scc-admin
$ oc get scc
NAME         PRIV      CAPS      HOSTDIR   SELINUX     RUNASUSER
privileged   true      []        true      RunAsAny    RunAsAny
restricted   false     []        false     MustRunAs   MustRunAsRange
scc-admin    true      []        false     RunAsAny    RunAsAny
----

[[deleting-security-context-constraints]]

== Deleting Security Context Constraints

[options="nowrap"]
----
$ oc delete scc scc-admin
securitycontextconstraints/scc-admin
----

NOTE: If you delete the default security context constraints they will not be regenerated upon
restart unless you delete all security context constraints.  If any constraint already exists
within the system, no generation will take place.

[[updating-security-context-constraints]]

== Updating Security Context Constraints

[options="nowrap"]
----
$ oc edit scc privileged
----

[[how-do-i]]

== How Do I?

[[grant-access-to-the-privileged-scc]]

=== Grant Access to the Privileged SCC

In some cases, an administrator might want to allow users or groups outside the
administrator group access to create more privileged pods. To do so, you can:

. Determine the user or group you would like to have access to the SCC.

. Run:
+
----
$ oc edit scc <name>
----

. Add the user or group to the *users* or *groups* field of the SCC.

For example, to allow the *e2e-user* access to the privileged SCC, add their
user:

====
----
$ oc edit scc privileged

allowHostDirVolumePlugin: true
allowPrivilegedContainer: true
apiVersion: v1
groups:
- system:cluster-admins
- system:nodes
kind: SecurityContextConstraints
metadata:
  creationTimestamp: 2015-06-15T20:44:53Z
  name: privileged
  resourceVersion: "58"
  selfLink: /api/v1/securitycontextconstraints/privileged
  uid: 602a0838-139f-11e5-8aa4-080027c5bfa9
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: RunAsAny
users:
- system:serviceaccount:openshift-infra:build-controller
- e2e-user <1>
----

<1> The *e2e-user* added to the users section.

====

[[enable-images-to-run-with-user-in-the-dockerfile]]

=== Enable Images to Run with USER in the Dockerfile

To relax the security in your cluster so that images are not forced to run as a
pre-allocated UID, without granting everyone access to the privileged SCC, you
can edit the restricted SCC and change the `*runAsUser*` strategy:

. Run:
+
----
$ oc edit scc restricted
----

. Change `*runAsUser.Type*` to *RunAsAny*.

[IMPORTANT]
====
This allows images to run as the root UID if no *USER* is specified in the
Dockerfile.
====

[[use-mount-host-on-the-registry]]

=== Use `--mount-host` on the Registry

It is recommended that persistent volumes be used for registry deployments. If
you are testing and would like to use the `--mount-host` option, the recommended
way to do so is:

. Create a new service account.
. Add the service account user name to the *privileged* SCC using:
+
----
$ oc edit scc privileged
----
+
Note that a fully-qualified service account user name is in the form of
*system:serviceaccount:<namesapce>:<name>*.

. Create the registry using `oadm registry --service-account=<name> --mount-host=<dir> ...`
